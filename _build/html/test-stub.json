{"version":3,"kind":"Notebook","sha256":"c08afce3387f8b3de6d678577886015bf47326cfad9c19a275fc5492f0982727","slug":"test-stub","location":"/test_stub.ipynb","dependencies":[],"frontmatter":{"title":"RF microstrip: quarter wave stub filter","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"numbering":{"title":{"offset":2}},"exports":[{"format":"ipynb","filename":"test_stub.ipynb","url":"/build/test_stub-380a6b56bc881c11bf632b87e1589a7f.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Overview","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RNmyRZGZCQ"}],"identifier":"overview","label":"Overview","html_id":"overview","implicit":true,"key":"YrvNvHZTNk"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We simulate a quarter wave stub bandstop filter in RF microstrip with nominal 5GHz notch.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"X1uR2XO5ZD"}],"key":"BuXCVuGW7z"}],"key":"R30Zf55ptg"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Geometry","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aSYmMOOA11"}],"identifier":"geometry","label":"Geometry","html_id":"geometry","implicit":true,"key":"NnkS4Eabul"}],"key":"KwxuIB0wlc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import luminescent as lumi\nfrom gdsfactory.technology import LogicalLayer, LayerLevel, LayerStack\nimport gdsfactory as gf\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport os\n\n# simulation folder \nstudy='microstrip_stub_filter'\npath = os.path.join('studies', study)\n\n# length and frequency units are arbitrary but must be consistent. here we use mm and GHz\nfrequency = 5  # characteristic frequency in GHz\nfrequencies = np.linspace(3, 7, 81).tolist()\nwl1f = 300  # vacuum wavelength at 1 unit of frequency, all in your units\nwavelength = wl1f / frequency  # characteristic wavelength\nbandwidth = max(frequencies) - min(frequencies)\n\n# microstrip\nw_line = 1.52  # mm\nth = 0.035  # mm\nd = 0.8  # mm\nc = 87.5 / 139  # relative signal speed, from microstrip calculator\n\nwl_sig = wl1f * c / frequency  # wavelength in the signal line\nl_stub = wl_sig / 4 # quarter-wave stub length\nl_feed = 1 * l_stub\nlateral_port_margin = height_port_margin = 2 * d\nmargin = zmargin = 1.25 * lateral_port_margin\nlx_mode = w_line + 2 * lateral_port_margin  # lateral size of mode region\nsource_port_margin = 1.5 * (w_line + 2 * lateral_port_margin)\n\n# layers\nFEED = 1, 0\nSTUB = 2, 0\nSUB = 10, 0\n\n# make geometry in gdsfadory\n# alternatively can import .gds into gdsfadory\nc = gf.Component()\nfeed = c << lumi.straight(length=l_feed, width=w_line, layer=FEED)\nstub = c << lumi.straight(length=l_stub, width=w_line, layer=STUB)\nstub.rotate(90)\nstub.movex(l_feed / 2)\next = c << lumi.straight(source_port_margin, width=w_line, layer=FEED)\next.connect(\"o2\", feed.ports[\"o1\"])\n\nfor i in (1, 2):\n    c.add_port(f\"o{i}\", port=feed.ports[f\"o{i}\"])\n\nc << gf.components.bbox(component=c, layer=SUB, top=margin, bottom=margin)\nc.plot()","key":"mCgxQ6WL6m"},{"type":"outputs","id":"k8Z2a6YHmf_cv0pyPp68N","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"running luminescent python frontenda\n"},"children":[],"key":"VLF5Z7QKi8"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7114bf13a945cd34d8e0cc546072a95a","path":"/build/7114bf13a945cd34d8e0cc546072a95a.png"},"text/plain":{"content":"<Figure size 800x600 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"Nj74ehZXgK"}],"key":"SqCY68QRoM"}],"key":"JF3mFP1PyC"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Solve","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sVtQQ1ivRg"}],"identifier":"solve","label":"Solve","html_id":"solve","implicit":true,"key":"JSlQp9qQSu"}],"key":"v1UrNe8BLT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# adaptive meshing\nnres = 16\ndx0 = wavelength / nres\n\nlayer_stack = LayerStack(\n    layers={\n        \"feed\": LayerLevel(\n            layer=LogicalLayer(layer=FEED),\n            zmin=0,\n            thickness=th,\n            material=\"PEC\",\n            mesh_order=10,\n        ),\n        \"stub\": LayerLevel(\n            layer=LogicalLayer(layer=STUB),\n            zmin=0,\n            thickness=th,\n            material=\"PEC\",\n            mesh_order=20,\n        ),\n        \"core\": LayerLevel(\n            layer=LogicalLayer(layer=SUB),\n            zmin=-d,\n            thickness=d,\n            material=\"sub\",\n            mesh_order=30,\n        ),\n    }\n)\n\n# materials\neps_sub = 4.3\nn_sub = np.sqrt(eps_sub)\n\ndx = w_line / 4  # 4 mesh points across the strip\nn_PEC = dx0 / (dx)  # mesh density relative to vacuum\n\nmaterial_library = {\n    \"sub\": lumi.Material(epsilon=eps_sub),\n    \"PEC\": lumi.PECMaterial(mesh_density=n_PEC),\n}\nmaterial_library[\"background\"] = lumi.Material(epsilon=1.0)\n\n_dx=dx \n_dy=th\nmodes = [\n    lumi.Mode(\n        ports=[\"o1\", \"o2\"],\n        frequencies=[frequency],\n        metallic_boundaries=[\"y-\", \"feed\"],\n        nmodes=1,\n        start=[-lx_mode/2, -d], # local xy frame, local y=0 at global zmin of port layer\n        stop=[lx_mode/2, th + height_port_margin],\n        voltage_line=[(0, -d), (0, 0)], # optional\n        current_loop=[\n            (-w_line / 2 - _dx,  - _dy),\n            (-w_line / 2 - _dx,  th + _dy),\n            (w_line / 2 + _dx,  th + _dy),\n            (w_line / 2 + _dx,  - _dy),\n        ], # optional\n    )\n]\n\nsources = [\n    lumi.Source(\n        \"o1\", frequency=frequency, duration=0.5, source_port_margin=source_port_margin\n    ) # modulated Gaussian pulse\n]\n\nviews=[\n        lumi.View(\"Ez\", x=-source_port_margin, y=0, z=-d / 2),\n        lumi.View(\"Hz\", z=th / 2),\n    ]\n \n# Luminescent community cloud client\nemail=____# replace with your registered email\nclient=lumi.Client(email,cloud='luminescent_community_cloud')\n\nlumi.make(\n    path=path,\n    component=c,\n    frequency=frequency, # characteristic frequency\n    frequencies=frequencies,\n    wl1f=wl1f,\n    sources=sources,\n    modes=modes,\n    # bounds\n    boundaries=[\"PML\", \"PML\", [\"PEC\", \"PML\"]],\n    zmin=-d,\n    zmax=th + zmargin,\n    #\n    material_library=material_library,\n    layer_stack=layer_stack,\n    # performance\n    nres=nres,\n    relative_courant=0.9,  # relative courant number between 0 and 1\n    relative_pml_depths=[1, 0.3, 0.3],\n    energy_decay_threshold=0.01,  # field decay threshold for stopping simulation\n    saveat=1,  # save frame for plotting every _ periods\n    # visualization\n    views=views,\n    # \n    client=client,\n)","key":"iSaUpBmZ1k"},{"type":"outputs","id":"Puyg1CqXmIJ-vBfGoK4-5","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"saving mode plots to /home/weihu/lumi/luminescent/studies/microstrip_stub_filter/modes/1\nshowing modes for first wavelength \nsolving modes with PEC boundaries\nSolving port modes with FEM...\n"},"children":[],"key":"Iz6z5zuy21"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"0add8a15de72c121412c123c763a47a9","path":"/build/0add8a15de72c121412c123c763a47a9.png"},"text/plain":{"content":"<Figure size 640x480 with 6 Axes>","content_type":"text/plain"}}},"children":[],"key":"VkuA3aQYuK"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4adc9eb730b7ccb0cbb6c1bda3fc40c2","path":"/build/4adc9eb730b7ccb0cbb6c1bda3fc40c2.png"},"text/plain":{"content":"<Figure size 640x480 with 6 Axes>","content_type":"text/plain"}}},"children":[],"key":"Pimj3Xlvzj"},{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/home/weihu/.local/lib/python3.12/site-packages/skfem/assembly/form/linear_form.py:44: ComplexWarning: Casting complex values to real discards the imaginary part\n  data[ixs] = self._kernel(vbasis.basis[i], w, dx)\n/home/weihu/lumi/luminescent/luminescent/utils.py:655: ComplexWarning: Casting complex values to real discards the imaginary part\n  E = np.array(\n/home/weihu/lumi/luminescent/luminescent/utils.py:668: ComplexWarning: Casting complex values to real discards the imaginary part\n  H = np.array(\n"},"children":[],"key":"bLx4pGgGRe"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"using simulation folder /home/weihu/lumi/luminescent/studies/microstrip_stub_filter\n0.19\nLoading mesh from: /home/weihu/lumi/luminescent/studies/microstrip_stub_filter/geometry/1____PEC____feed____unnamed11.obj\n0.19\nLoading mesh from: /home/weihu/lumi/luminescent/studies/microstrip_stub_filter/geometry/2____PEC____feed____unnamed21.obj\n0.19\nLoading mesh from: /home/weihu/lumi/luminescent/studies/microstrip_stub_filter/geometry/3____PEC____stub____unnamed31.obj\n0.9042052915695228\nLoading mesh from: /home/weihu/lumi/luminescent/studies/microstrip_stub_filter/geometry/4____sub____core____unnamed41.obj\n"},"children":[],"key":"xspRbbuTsU"}],"key":"HTTQrUDzJQ"}],"key":"l9OvHVZZBZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"lumi.solve(path)","key":"Veki7m826k"},{"type":"outputs","id":"8gbtBSuHzK8_QwJxOBTll","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"loading problem from /home/weihu/lumi/luminescent/studies/microstrip_stub_filter\n\n\nservers:\n['server0', 'READY']\n['server1', 'TERMINATED']\n['server2', 'ERROR']\n['server3', 'ERROR']\n\njob queue on luminescent_community_cluster:\n\nsubmitted job to cluster luminescent_community_cluster, awaiting uptake by server ...\nif you abort this python client, you'll also abort the job on the cluster queue!\n\n========================================\nbackend loading simulation folder ...\n\nCPU:\n\tthreads: 48\n\nGPU 0: NVIDIA RTX PRO 6000 Blackwell Server Edition\n\tCUDA Compute Capability: 12.0.0\n\tVRAM: 94.97076416015625 GB\n\n========================================\nsetting up simulation...\n\nmeshing geometry\nmaking sources...\nmaking monitors...\nmaking designs...\n\n========================================\nsimulation config\n\nbackend: GPU\nfloat: Float32\n\noriginal size: (46, 36, 17)\npadded size: (91, 50, 24)\ncell count: 109,200\n\nrelative Courant number: 0.9\nstep size: 1936.0 steps/period\nsource duration: 0.50 periods\nmax time: 1,000.50 periods    \nenergy decay threshold: 0.01\n\n========================================\nrunning simulation...\n\naccumulating dft fields...\nperiod 0.00, Inf seconds/period\nperiod 0.25, 2.31 seconds/period\nperiod 1.00, energy 0.3643, 2.55 seconds/period\nperiod 2.00, energy 0.0529, 2.58 seconds/period\nperiod 3.00, energy 0.0121, 2.65 seconds/period\nperiod 3.61, energy 0.0098, 3.04 seconds/period\nstop on field decay\n\nsimulation completed.\n\n========================================\ngenerating movie...\n\n\nmovie frames completed.\nsimulation completed successfully!\n"},"children":[],"key":"X7gUjvlWFG"}],"key":"NHu2vBpKDY"}],"key":"mSMBSfMsQu"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualize","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XtbtngSc1N"}],"identifier":"visualize","label":"Visualize","html_id":"visualize","implicit":true,"key":"GuwEcdMyFa"}],"key":"sGWLyp4t46"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"lumi.movie(path)","key":"msNRQ5Vf1z"},{"type":"outputs","id":"OeuOl7uV-3yVrJaCI3Fyq","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Video generated successfully at /home/weihu/lumi/luminescent/studies/microstrip_stub_filter/simulation.gif!\n"},"children":[],"key":"T9T9ee51O5"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/gif":{"content_type":"image/gif","hash":"82f1a0ffd83c430c848510130b2b3da2","path":"/build/82f1a0ffd83c430c848510130b2b3da2.gif"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"children":[],"key":"sQCH0LY6D9"}],"key":"gThNmXrh1d"}],"key":"CwnYIPbmrC"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Analysis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"P8vsTjMBm1"}],"identifier":"analysis","label":"Analysis","html_id":"analysis","implicit":true,"key":"R49wIjtR8P"}],"key":"nJFPrTdKmp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"sol = lumi.load(path)\nx = frequencies\ny = lumi.query(sol, \"To2,o1\") # convenience function for T-parameters using modal decomposition\n\n# S-parameters can also be computed explicitly from complex valued modal or voltage waves:\n# y = np.abs2(sol[\"waves\"][\"o2@0+\"] / sol[\"waves\"][\"o1@0-\"]) # explicit T21 using forward/backward modal amplitudes\n# y = np.abs2(sol[\"waves\"][\"o2+\"] / sol[\"waves\"][\"o1-\"]) # using forward/backward voltage waves\n\ny = [10 * np.log10(v) for v in y]\nplt.plot(x, y)\nplt.xlabel(\"f [GHz]\")\nplt.ylabel(\"S21 [dB]\")\nplt.show()","key":"C6yM6NtQVM"},{"type":"outputs","id":"K8YOX8T49q95xrla6_SDi","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"loading solution from /home/weihu/lumi/luminescent/studies/microstrip_stub_filter\nmay take a minute if simulation folder is remotely mounted\n"},"children":[],"key":"IFvGeyTl4w"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"b2c6ced83b66a3f6982eb3f788cc34b6","path":"/build/b2c6ced83b66a3f6982eb3f788cc34b6.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"iQEDBcsAob"}],"key":"XVdfIbp9k3"}],"key":"YwjyzSXg6e"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"y=377*sol['Z']['o1']\nplt.plot(x,np.real(y),label=\"Real\",color='orange')\nplt.plot(x,np.imag(y),label=\"Imaginary\",color='blue')\nplt.xlabel(\"f [GHz]\")\nplt.ylabel('complex line impedance [Ohms]')\nplt.legend()\nplt.show()","key":"OPH0mrKJwQ"},{"type":"outputs","id":"jyygDRZ1NJTg9p5M7yDeJ","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"65c36634582c00dedf7cd74d5b10e2fc","path":"/build/65c36634582c00dedf7cd74d5b10e2fc.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"QFYdEdAQlD"}],"key":"wXM8hsj8DB"}],"key":"RMEkFG9H8W"}],"key":"JNHYi3t1er"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Photonic integrated circuit: ring resonator","url":"/test-ring","group":"Simulation tutorials"},"next":{"title":"Inverse design of photonic wavelength division demultiplexer","url":"/opt-demux","group":"Inverse design tutorials"}}},"domain":"http://localhost:3012"}