{"version":3,"kind":"Notebook","sha256":"cdb28eae887ddf1e330a309ad8072dc0b3bc12531b0ab248e6f7012239b93104","slug":"test-ring","location":"/test_ring.ipynb","dependencies":[],"frontmatter":{"title":"Photonic integrated circuit: ring resonator","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"numbering":{"title":{"offset":2}},"exports":[{"format":"ipynb","filename":"test_ring.ipynb","url":"/build/test_ring-e919609be14f152f42faba82667e5283.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Overview","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Hq4oY9QvAN"}],"identifier":"overview","label":"Overview","html_id":"overview","implicit":true,"key":"X90katKz41"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We simulate small silicon ring resonator coupled to parallel waveguides buried in silica cladding. We use midplane z PMC symmetry to slash cell count by half.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"jWkiBwrYsi"}],"key":"tXwq2pKPg3"}],"key":"aFwnOTJyOw"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Geometry","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JzBv0N9a9s"}],"identifier":"geometry","label":"Geometry","html_id":"geometry","implicit":true,"key":"xWO8eORjX4"}],"key":"c1ewm0PsVe"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import luminescent as lumi\nfrom gdsfactory.technology import LogicalLayer, LayerLevel, LayerStack\nimport gdsfactory as gf\nimport numpy as np\nimport os\nimport matplotlib.pyplot as plt\n\n# simulation folder \nstudy='photonic_ring_resonator'\npath = os.path.join('studies', study)\n\n# length units are arbitrary so long as they are consistent, in this case [um]. everything gets normalized around origin wavelength and period at backend.\nwavelength = 1.55  # characteristic wavelength [um]\nbandwidth = 0.1  # wavelength bandwidth [um]\nwavelengths = np.linspace(wavelength - bandwidth / 2, wavelength + bandwidth / 2, 401)\n\nr = 3.1  # radius of ring\nw_wg = 0.4  # width of waveguide\ngap = 0.1  # gap between waveguide and ring\nh_wg = 0.18  # h_wg of waveguide\n\n# gds layers\nWG = (1, 0)  # waveguide layer\nBBOX = (10, 0)  # bounding box layer\n\n# we create geometry in gdsfactory. alternatively, you can import .gds layout into gdsfactory or .stl bodies directly into ours\n\n# margins\nheight_port_margin = lateral_port_margin = 0.8\nmargin = 1.2 * lateral_port_margin\nzmargin = 1.2 * height_port_margin\nsource_port_margin = 1.0 * (w_wg + 2 * lateral_port_margin)\n\n# draw layout in gdsfactory. `gf.components` defaults to layer WG = (1, 0)\nc = gf.Component()\n\ndut = c << gf.components.ring(radius=r, width=w_wg, layer=WG)\n\nl_branch = 2 * r + w_wg + source_port_margin + 2*margin\nxoffset = -source_port_margin - margin - r - w_wg / 2\nyoffset = w_wg + gap + r\nbranch_top = c << gf.components.straight(length=l_branch, width=w_wg)\nbranch_top.move((xoffset, w_wg + gap + r))\n\nbranch_bottom_left = c << gf.components.straight(length=source_port_margin, width=w_wg)\nbranch_bottom_left.move((xoffset, -yoffset))\n\nbranch_bottom_right = c << gf.components.straight(length=l_branch - source_port_margin, width=w_wg)\nbranch_bottom_right.connect(\"o1\", branch_bottom_left.ports[\"o2\"])\n\n\n# add ports\nc.add_port(\"o1\", port=branch_bottom_right.ports[\"o1\"])\nc.add_port(\"o2\", port=branch_bottom_right.ports[\"o2\"])  # thru channel\nc.add_port(\"o3\", port=branch_top.ports[\"o1\"])  # drop channel\n\nc << gf.components.bbox(component=c, layer=BBOX, top=margin, bottom=margin)\nc.plot()","key":"hyEo2SOxcC"},{"type":"outputs","id":"p0PcdCv24tlb5zWP-DycH","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"running luminescent python frontenda\n"},"children":[],"key":"dnHGVOOOTT"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"da3a3e64b387eda9158433ef8b99f537","path":"/build/da3a3e64b387eda9158433ef8b99f537.png"},"text/plain":{"content":"<Figure size 800x600 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"fV7KSS5qqe"}],"key":"skyrm9g8gZ"}],"key":"HmUuIzFwVL"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Solve","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NIC4cFDN8m"}],"identifier":"solve","label":"Solve","html_id":"solve","implicit":true,"key":"RvAGIWciga"}],"key":"xTTuuH636L"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# for gdsfactory, we need vertical layer stack. \"core\" layer is special as `height_port_margin` are demarcated from it for defining modal sources and monitors. during 3d meshing lower mesh order layers supplant higher mesh order layers\nlayer_stack = LayerStack(\n    layers={\n        \"core\": LayerLevel(\n            layer=LogicalLayer(layer=WG),\n            thickness=h_wg/2,\n            zmin=0.0,\n            material=\"Si\",\n            mesh_order=10,\n        ),\n    }\n)\n\n# our default lumi.MATERIAL_LIBRARY lib covers limited range of photonic and PCB material_library. here we create our own material_library. `background` is special and tags regions outside any bodies during meshing\nmaterial_library = {\n    \"Si\": lumi.Material(epsilon=12.25),\n    \"SiO2\": lumi.Material(epsilon=2.25),\n}\nmaterial_library[\"background\"] = material_library[\n    \"SiO2\"\n]  \n\n# source launches `source_port_margin` in front of port. it's bidirectional: the other direction goes into PML. pulse spectrum rolls off gradually past bandwidth limits.\nsources = [\n    lumi.Source(\n        \"o1\",\n        source_port_margin=source_port_margin,\n        wavelength=wavelength,\n        bandwidth=wavelength/5,\n        modenums=[0],  # fundamental mode only\n    )\n]\n\nlx = w_wg + 2 * lateral_port_margin\nly = h_wg + 2 * height_port_margin\nmodes = [\n    lumi.Mode(\n        wavelengths=np.linspace(wavelengths[0], wavelengths[-1],5),\n        start=[-lx / 2, 0],  # local xy frame\n        stop=[lx / 2, h_wg/2 + height_port_margin],\n        boundaries=['PML',('PMC','PML')]\n    )\n]\n\n# Luminescent community cloud client\nemail=____ # replace with your registered email\nclient=lumi.Client(email,cloud='luminescent_community_cloud')\n\nlumi.make(\n    path=path,\n    component=c,\n    wavelengths=wavelengths,\n    sources=sources,\n    modes=modes,\n    # limits\n    boundaries=['PML','PML',('PMC','PML')], # z midplane PMC symmetry\n    zmin=0,\n    zmax=h_wg/2 + zmargin,\n    # materials and layers\n    material_library=material_library,\n    layer_stack=layer_stack,\n    # accuracy and speed settings\n    nres=8,  # number of grid points per wavelength in material (not vacuum)\n    relative_courant=0.95,  # relative to maximum theoretical Courant number at\n    relative_pml_depths=[1, 1, 0.25],  \n    tmax=1000,  # max time [periods]\n    energy_decay_threshold=0.001,  # field energy decay threshold for stopping simulation\n    saveat=25,  # save and plot field every _ periods, involves slow disk write\n    # visualization\n    views=[lumi.View(\"Hz\",x=0,y=0,z=0)],\n    # \n    client=client,\n)","key":"OIm2Xr55dq"},{"type":"outputs","id":"XJOdR_Y2ivkcGLAcXjeZi","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"saving mode plots to /home/weihu/lumi/luminescent/studies/photonic_ring_resonator/modes/1\nshowing modes for first wavelength \nmode Boundary conditions: 0A00\n/home/weihu/lumi/luminescent/studies/photonic_ring_resonator/modes/1/1.5 mode 0 (neff=2.264+0.000j)\n/home/weihu/lumi/luminescent/studies/photonic_ring_resonator/modes/1/1.5 mode 1 (neff=1.433+0.000j)\nmode Boundary conditions: 0A00\nmode Boundary conditions: 0A00\nmode Boundary conditions: 0A00\nmode Boundary conditions: 0A00\nusing simulation folder /home/weihu/lumi/luminescent/studies/photonic_ring_resonator\n0.02767857142857143\nLoading mesh from: /home/weihu/lumi/luminescent/studies/photonic_ring_resonator/geometry/1____Si____core____unnamed11.obj\n0.02767857142857143\nLoading mesh from: /home/weihu/lumi/luminescent/studies/photonic_ring_resonator/geometry/2____Si____core____unnamed21.obj\n0.02767857142857143\nLoading mesh from: /home/weihu/lumi/luminescent/studies/photonic_ring_resonator/geometry/4____Si____core____unnamed41.obj\n0.02767857142857143\nLoading mesh from: /home/weihu/lumi/luminescent/studies/photonic_ring_resonator/geometry/3____Si____core____unnamed31.obj\n"},"children":[],"key":"zUVGpSEstL"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"f9f42b6a371de31246286f79fd1877bd","path":"/build/f9f42b6a371de31246286f79fd1877bd.png"},"text/plain":{"content":"<Figure size 640x480 with 6 Axes>","content_type":"text/plain"}}},"children":[],"key":"mWpivIhKTF"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"cf19f9f33f7508d79303091bfcffe1e7","path":"/build/cf19f9f33f7508d79303091bfcffe1e7.png"},"text/plain":{"content":"<Figure size 640x480 with 6 Axes>","content_type":"text/plain"}}},"children":[],"key":"gj6DbKdLoq"}],"key":"M3OwTy0QZi"}],"key":"Cg8e9TaZeH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"lumi.solve(path)","key":"ZwzTXxWe3Q"},{"type":"outputs","id":"QDaMOvRTlmpTxUXpQCxWP","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"loading problem from /home/weihu/lumi/luminescent/studies/photonic_ring_resonator\n\n\nservers:\n['server0', 'READY']\n['server1', 'TERMINATED']\n['server2', 'ERROR']\n['server3', 'ERROR']\n\njob queue on luminescent_community_cluster:\n\nsubmitted job to cluster luminescent_community_cluster\nif you abort this python client, you'll also abort the job on the server!\n\n========================================\nbackend loading simulation folder ...\n\nCPU:\n\tthreads: 48\n\nGPU 0: NVIDIA RTX PRO 6000 Blackwell Server Edition\n\tCUDA Compute Capability: 12.0.0\n\tVRAM: 94.97076416015625 GB\n\n========================================\nsetting up simulation...\n\nmeshing geometry\nmaking sources...\nmaking monitors...\nmaking designs...\n\n========================================\nsimulation config\n\nbackend: GPU\nfloat: Float32\n\noriginal size: (193, 158, 11)\npadded size: (219, 170, 13)\ncell count: 483,990\n\nrelative Courant number: 0.95\nstep size: 40.0 steps/period\nsource duration: 4.95 periods\nmax time: 1,004.95 periods    \nenergy decay threshold: 0.001\n\n========================================\nrunning simulation...\n\naccumulating dft fields...\nperiod 0.00, Inf seconds/period\nperiod 2.50, 0.11 seconds/period\nperiod 25.00, energy 0.601, 0.12 seconds/period\nperiod 50.00, energy 0.1713, 0.12 seconds/period\nperiod 75.00, energy 0.085, 0.12 seconds/period\nperiod 100.00, energy 0.0563, 0.12 seconds/period\nperiod 125.00, energy 0.0393, 0.12 seconds/period\nperiod 150.00, energy 0.0295, 0.13 seconds/period\nperiod 175.00, energy 0.0226, 0.12 seconds/period\nperiod 200.00, energy 0.018, 0.12 seconds/period\nperiod 225.00, energy 0.0147, 0.12 seconds/period\nperiod 250.00, energy 0.0121, 0.12 seconds/period\nperiod 275.00, energy 0.0103, 0.13 seconds/period\nperiod 300.00, energy 0.0087, 0.12 seconds/period\nperiod 325.00, energy 0.008, 0.12 seconds/period\nperiod 350.00, energy 0.0065, 0.12 seconds/period\nperiod 375.00, energy 0.0063, 0.12 seconds/period\nperiod 400.00, energy 0.0051, 0.13 seconds/period\nperiod 425.00, energy 0.005, 0.12 seconds/period\nperiod 450.00, energy 0.0043, 0.12 seconds/period\nperiod 475.00, energy 0.0039, 0.12 seconds/period\nperiod 500.00, energy 0.0035, 0.12 seconds/period\nperiod 525.00, energy 0.0032, 0.13 seconds/period\nperiod 550.00, energy 0.0029, 0.12 seconds/period\nperiod 575.00, energy 0.0026, 0.12 seconds/period\nperiod 600.00, energy 0.0024, 0.12 seconds/period\nperiod 625.00, energy 0.0021, 0.12 seconds/period\nperiod 650.00, energy 0.002, 0.13 seconds/period\nperiod 675.00, energy 0.0018, 0.12 seconds/period\nperiod 700.00, energy 0.0016, 0.12 seconds/period\nperiod 725.00, energy 0.0015, 0.12 seconds/period\nperiod 750.00, energy 0.0015, 0.12 seconds/period\nperiod 775.00, energy 0.0013, 0.13 seconds/period\nperiod 800.00, energy 0.0012, 0.12 seconds/period\nperiod 825.00, energy 0.0011, 0.12 seconds/period\nperiod 850.00, energy 0.0011, 0.12 seconds/period\nperiod 874.97, energy 0.001, 0.12 seconds/period\nstop on field decay\n\nsimulation completed.\n\n========================================\ngenerating movie...\n\n\nmovie frames completed.\nsimulation completed successfully!\n"},"children":[],"key":"knb0DXfmaI"}],"key":"G4SUvX33Q5"}],"key":"lR6qpyojnp"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualize","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ooleoAKdxn"}],"identifier":"visualize","label":"Visualize","html_id":"visualize","implicit":true,"key":"g5aC7e4WX3"}],"key":"u6hsI68nkJ"},{"type":"block","kind":"notebook-content","children":[],"key":"p4a2wDxhUx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"lumi.movie(path) # full movie - this may take a while to generate","key":"iyNEjRdbKD"},{"type":"outputs","id":"74em4mtUv3GUhY50wODPo","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Video generated successfully at /home/weihu/lumi/luminescent/studies/photonic_ring_resonator/simulation.gif!\n"},"children":[],"key":"skILfkP0LI"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/gif":{"content_type":"image/gif","hash":"240f077dab2f89eb2675ea2609fc1e81","path":"/build/240f077dab2f89eb2675ea2609fc1e81.gif"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"children":[],"key":"Tw4EXxHskj"}],"key":"u4sgfWvyL3"}],"key":"f4kcJ4Xcwx"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Analysis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OSAPokL3O0"}],"identifier":"analysis","label":"Analysis","html_id":"analysis","implicit":true,"key":"uQ6Cpcn8JH"}],"key":"HpG6UQ2biZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"sol = lumi.load(path)\nx = wavelengths\n\n# S or T params. wavelength or frequency ordered depending on problem setup\ny = lumi.query(sol, \"To3@0,o1@0\")  # same as y=np.abs2(sol['waves']['o3@0+']/sol['waves']['o1@0-'])\n# y = lumi.query(sol, \"T3,1\") # flux\n\nplt.plot(x, y)\nplt.xlabel(\"wavelength [um]\")\nplt.ylabel(\"drop channel transmitted power\")\nplt.show()","key":"UPUvASdvfo"},{"type":"outputs","id":"bL4LKBY7GMXJRgflzf4Gs","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"loading solution from /home/weihu/lumi/luminescent/studies/photonic_ring_resonator\nmay take a minute if simulation folder is remotely mounted\n"},"children":[],"key":"DOYh6t1mnn"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"8cdb53670d22c12353b0dfdb768c03e0","path":"/build/8cdb53670d22c12353b0dfdb768c03e0.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"Qu7VsCmamk"}],"key":"ayAiVywhfi"}],"key":"iu8gBdSq9k"}],"key":"vtWAg7gFao"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Metasurface: microwave frequency selective surface (FSS)","url":"/test-fss","group":"Simulation tutorials"},"next":{"title":"RF microstrip: quarter wave stub filter","url":"/test-stub","group":"Simulation tutorials"}}},"domain":"http://localhost:3000"}