{"version":3,"kind":"Notebook","sha256":"f12be2d2644a33de253e0c12beb01c98997ec5846da8292b57f481df8d92bba0","slug":"test-fss","location":"/test_FSS.ipynb","dependencies":[],"frontmatter":{"title":"Metasurface: microwave frequency selective surface (FSS)","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"numbering":{"title":{"offset":2}},"exports":[{"format":"ipynb","filename":"test_FSS.ipynb","url":"/build/test_FSS-05e54ae87d3a7e286de44c3e0638571a.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Overview","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"otJRZcixBs"}],"identifier":"overview","label":"Overview","html_id":"overview","implicit":true,"key":"IP7plTLr0c"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We simulate microwave frequency selective surface (FSS) with 12GHz bandstop. periodic Metal cross array on dielectric substrate. Compare with Tidy3D example ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"eqD6kJ6DPy"},{"type":"link","url":"https://www.flexcompute.com/tidy3d/examples/notebooks/MicrowaveFrequencySelectiveSurface","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"https://​www​.flexcompute​.com​/tidy3d​/examples​/notebooks​/MicrowaveFrequencySelectiveSurface","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"EQcSWm0cab"}],"urlSource":"https://www.flexcompute.com/tidy3d/examples/notebooks/MicrowaveFrequencySelectiveSurface","key":"B9JYUxXsZs"}],"key":"RtITdOb8cc"}],"key":"ijXYy0VbbQ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Geometry","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Wv5TXO5E9B"}],"identifier":"geometry","label":"Geometry","html_id":"geometry","implicit":true,"key":"rYKYXNhd0t"}],"key":"Ss8u6Cb8tQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import luminescent as lumi\nfrom gdsfactory.technology import LogicalLayer, LayerLevel, LayerStack\nimport gdsfactory as gf\nimport math\nimport numpy as np\nimport os\nimport matplotlib.pyplot as plt\n\n# simulation folder\nstudy='microwave_frequency_selective_surface'\npath = os.path.join('studies', study)\n\n# length and frequency units are arbitrary\nfrequency = 12  # origin frequency GHz\nbw = 4  # bandwidth\ndf = 0.05  # frequency step\nwl1f = 300  # vacuum wavelength at 1 unit of frequency in your units\nwl = wl1f / frequency  # characteristic wavelength\nfrequencies = np.linspace(frequency-bw/2, frequency+bw/2, round(bw/df+1))\n\n# unit cell [mm]\nP = 15  # periodicity\nL = 9.4  # length of cross\nW = 2.0  # width of cross stub\nd = 2.2  # height of substrate\nth = 0.1  # metal thickness\ngap = 30.0  # air gap below and above - keeps resonant evanescent field from coupling to lossy PML\nmargin = 2.0\n\n# adaptive meshing\ndx=W/5  # desired spatial resolution\nnres = 16\ndx0 = wl / nres\nmesh_density = dx0 /dx\n\n# material_library\nmaterial_library = lumi.MATERIAL_LIBRARY\nmaterial_library[\"sub\"] = lumi.Material(epsilon=2.5, mesh_density=mesh_density)\nmaterial_library[\"PEC\"] = lumi.PECMaterial(mesh_density=mesh_density)\n\n# make geometry in gdsfactory. 1/4 section of unit cell due to symmetry\n# alternatively can import .gds into gdsfactory\n\nWG = (1, 0)\nBBOX = (2, 0)\n\nlayer_stack = LayerStack(\n    layers={\n        \"WG\": LayerLevel(\n            layer=LogicalLayer(layer=WG),\n            thickness=th,\n            zmin=0,\n            material=\"PEC\",\n            mesh_order=1,\n        ),\n        \"sub\": LayerLevel(\n            layer=LogicalLayer(layer=BBOX),\n            thickness=d,\n            zmin=-d,\n            material=\"sub\",\n            mesh_order=2,\n        ),\n    }\n)\n\nc = gf.Component()\nc.add_polygon(\n    [(0, 0), (0, L / 2), (W / 2, L / 2), (W / 2, 0)],\n    layer=WG,\n)\np = c.add_polygon(\n    [(W / 2, W / 2), (W / 2, 0), (L / 2, 0), (L / 2, W / 2)],\n    layer=WG,\n)\nc.add_polygon([(0, 0), (0, P / 2), (P / 2, P / 2), (P / 2, 0)], layer=BBOX)\nc.plot()","key":"gvQkzIE7Oo"},{"type":"outputs","id":"NZ1T0LQ7bBoHcOG5IGlQZ","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"running luminescent python frontenda\n"},"children":[],"key":"xjRHKJXESJ"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"e3f7be9e543563049382f2d6f614a1ec","path":"/build/e3f7be9e543563049382f2d6f614a1ec.png"},"text/plain":{"content":"<Figure size 800x600 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"THiwSYwisf"}],"key":"Bhu4JW79iN"}],"key":"YqleOV875Z"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Problem","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vNszk0pIDb"}],"identifier":"problem","label":"Problem","html_id":"problem","implicit":true,"key":"Ki1whU2yJl"}],"key":"cidpRKqBQq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"","key":"DsZxIU5JtB"},{"type":"outputs","id":"UNR3SBxvklAHH3o7rh4Ay","children":[],"key":"lMh7Q2bJS3"}],"key":"dUh5sJMFRT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"xc = P / 4\nyc = P / 4\nports = [\n    lumi.PlanePort(\n        name='o1',\n        origin=[xc, yc, th + gap],\n        frame=[[1, 0, 0], [0, 1, 0], [0, 0, 1]],\n    ),\n    lumi.PlanePort(\n        name='o2',\n        origin=[xc, yc, -d- gap],\n        frame=[[-1, 0, 0], [0, 1, 0], [0, 0, -1]],\n    ),\n]\n\nnx=ny=round(P/2/dx)\na=np.ones((nx,ny))\nmodes = [lumi.Mode(\n    frequencies=[frequency],\n    fields=[[{\"Ex\": a, \"Hy\": a},{\"Ey\": a, \"Hx\": -a}]],\n    start=[-P/4, -P/4],\n    stop=[P/4, P/4],\n    )]\n\nsources = [lumi.Source(\"o1\", source_port_margin=margin, frequency=frequency, bandwidth=bw)]\n\nviews=[lumi.View('Ex',x=0,y=0,z=th/2)]\n\n# Luminescent community cloud client\nemail=____# replace with your registered email\nclient=lumi.Client(email,cloud='luminescent_community_cloud')\n\nlumi.make(\n    path,\n    component=c,\n    frequencies=frequencies,\n    wl1f=wl1f,\n    # antisymmetric/PEC/odd vs symmetric/PMC/even symmetry\n    boundaries=[\"PEC\", \"PMC\", \"PML\"],\n    #\n    sources=sources,\n    ports=ports,\n    modes=modes,\n    zmin=-gap-d,\n    zmax= th + gap + margin,\n    #\n    material_library=material_library,\n    layer_stack=layer_stack,\n    #\n    relative_courant=0.9,  # relative courant number between 0 and 1\n    nres=nres,\n    tmax=50,  # max time [periods]\n    energy_decay_threshold=0.001,  # field decay threshold for stopping simulation\n    saveat=1,\n    # visualization\n    views=views,\n    # \n    client=client,\n)","key":"SU57ltBBV1"},{"type":"outputs","id":"p064iubyaSG09AWuyPhma","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"saving mode plots to /home/weihu/lumi/luminescent/studies/microwave_frequency_selective_surface/modes/1\nusing simulation folder /home/weihu/lumi/luminescent/studies/microwave_frequency_selective_surface\n0.2\nLoading mesh from: /home/weihu/lumi/luminescent/studies/microwave_frequency_selective_surface/geometry/1____PEC____WG____unnamed11.obj\n0.2\nLoading mesh from: /home/weihu/lumi/luminescent/studies/microwave_frequency_selective_surface/geometry/3____sub____sub____unnamed31.obj\n0.2\nLoading mesh from: /home/weihu/lumi/luminescent/studies/microwave_frequency_selective_surface/geometry/2____PEC____WG____unnamed21.obj\n"},"children":[],"key":"Zb8VcIMvoE"}],"key":"BL0ZEpDANo"}],"key":"mnvsw9sM0e"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"lumi.solve(path)","key":"pvzBop55HV"},{"type":"outputs","id":"eC0ubQn25zn5LfgvrqUiO","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"loading problem from /home/weihu/lumi/luminescent/studies/microwave_frequency_selective_surface\n\n\nservers:\n['server0', 'READY']\n['server1', 'TERMINATED']\n['server2', 'ERROR']\n['server3', 'ERROR']\n\njob queue on luminescent_community_cluster:\n\nsubmitted job to cluster luminescent_community_cluster\nif you abort this python client, you'll also abort the job on the server!\n\n========================================\nbackend loading simulation folder ...\n\nCPU:\n\tthreads: 48\n\nGPU 0: NVIDIA RTX PRO 6000 Blackwell Server Edition\n\tCUDA Compute Capability: 12.0.0\n\tVRAM: 94.97076416015625 GB\n\n========================================\nsetting up simulation...\n\nmeshing geometry\nmaking sources...\nmaking monitors...\nmaking designs...\n\n========================================\nsimulation config\n\nbackend: GPU\nfloat: Float32\n\noriginal size: (21, 21, 58)\npadded size: (21, 21, 72)\ncell count: 31,752\n\nrelative Courant number: 0.9\nstep size: 302.0 steps/period\nsource duration: 3.00 periods\nmax time: 53.00 periods    \nenergy decay threshold: 0.001\n\n========================================\nrunning simulation...\n\naccumulating dft fields...\nperiod 0.00, Inf seconds/period\nperiod 1.00, 1.79 seconds/period\nperiod 1.50, 0.40 seconds/period\nperiod 2.00, energy 0.9393, 0.39 seconds/period\nperiod 3.00, energy 1.0701, 0.55 seconds/period\nperiod 4.00, energy 0.8944, 0.44 seconds/period\nperiod 5.00, energy 0.3309, 0.36 seconds/period\nperiod 6.00, energy 0.1323, 0.36 seconds/period\nperiod 7.00, energy 0.0516, 0.60 seconds/period\nperiod 8.00, energy 0.0195, 0.35 seconds/period\nperiod 9.00, energy 0.0062, 0.36 seconds/period\nperiod 10.00, energy 0.0023, 0.36 seconds/period\nperiod 11.00, energy 0.0008, 0.67 seconds/period\nperiod 12.00, energy 0.0004, 0.35 seconds/period\nperiod 13.00, energy 0.0002, 0.36 seconds/period\nperiod 13.24, energy 0.0002, 0.45 seconds/period\nstop on field decay\n\nsimulation completed.\n\n========================================\ngenerating movie...\n\n\nmovie frames completed.\nsimulation completed successfully!\n"},"children":[],"key":"oHpGprt1PF"}],"key":"CBfMcm6aEP"}],"key":"xGs5OC1Sxe"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Movie","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iVIess5IeJ"}],"identifier":"movie","label":"Movie","html_id":"movie","implicit":true,"key":"M6hg0SGXna"}],"key":"L3zOfilbot"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"lumi.movie(path)","key":"SXHvoED3R8"},{"type":"outputs","id":"_zugcoR199BFB-kA2khfr","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Video generated successfully at /home/weihu/lumi/luminescent/studies/microwave_frequency_selective_surface/simulation.gif!\n"},"children":[],"key":"nSVtdluFjT"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/gif":{"content_type":"image/gif","hash":"ac1925237d3825cba7259e342d3219ac","path":"/build/ac1925237d3825cba7259e342d3219ac.gif"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"children":[],"key":"jdZsGuOeRb"}],"key":"jLLtHp5Uwi"}],"key":"pv7tGpzNWn"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Analysis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pLY8nopJcL"}],"identifier":"analysis","label":"Analysis","html_id":"analysis","implicit":true,"key":"BQKaKv9kKz"}],"key":"gA3WYWXNO8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"sol = lumi.load(path)\nx = frequencies\ny = [10 * math.log10(x) for x in lumi.query(sol,'T2,1')]\nplt.plot(x, y)\nplt.xlabel(\"f [GHz]\")\nplt.ylabel(\"S21 [dB]\")\nplt.show()","key":"lWqIdUhTrW"},{"type":"outputs","id":"u7gLbNHbSI3LxV4obWpCs","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"loading solution from /home/weihu/lumi/luminescent/studies/microwave_frequency_selective_surface\nmay take a minute if simulation folder is remotely mounted\n"},"children":[],"key":"S9rdpZYvBs"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"3c86e1495411eff94bfe6544ae90c767","path":"/build/3c86e1495411eff94bfe6544ae90c767.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"BCrpetZxlf"}],"key":"ASibiVpFJw"}],"key":"nYhe8qEZoT"}],"key":"CdwZTuC44R"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Installation","url":"/install","group":"Lumi FDTD"},"next":{"title":"Photonic integrated circuit: ring resonator","url":"/test-ring","group":"Simulation tutorials"}}},"domain":"http://localhost:3004"}