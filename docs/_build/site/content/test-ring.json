{"version":3,"kind":"Notebook","sha256":"ed170198730a40dbc3b24e0a1d12b59b3e996118c60b4c87ba39d41da6b1f67e","slug":"test-ring","location":"/test_ring.ipynb","dependencies":[],"frontmatter":{"title":"Photonic integrated circuit: ring resonator","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"base","language":"python"},"numbering":{"title":{"offset":2}},"exports":[{"format":"ipynb","filename":"test_ring.ipynb","url":"/test_ring-bf1e76f599c7bc744acfb664b45850af.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Overview","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uEgHKJTIWp"}],"identifier":"overview","label":"Overview","html_id":"overview","implicit":true,"key":"aJEevs26Hs"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We simulate small silicon ring resonator coupled to parallel waveguides buried in silica cladding. Compare with ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"yvCXcWplZl"},{"type":"link","url":"https://optics.ansys.com/hc/en-us/articles/360042800293-Ring-resonator-getting-started-Design-and-initial-simulation","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Lumerical example","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"P0wc9Hjetw"}],"urlSource":"https://optics.ansys.com/hc/en-us/articles/360042800293-Ring-resonator-getting-started-Design-and-initial-simulation","key":"MYkX9Cq5ka"}],"key":"hIN6GqwYQJ"}],"key":"aCI7F7ao1A"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Geometry","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NXO5mvObt6"}],"identifier":"geometry","label":"Geometry","html_id":"geometry","implicit":true,"key":"vlyvO3ZsBm"}],"key":"fWoMnJXrBz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import luminescent as lumi\nfrom gdsfactory.technology import LogicalLayer, LayerLevel, LayerStack\nimport gdsfactory as gf\nimport numpy as np\nimport os\nimport math\nimport matplotlib.pyplot as plt\n\n# simulation folder\nname='photonic_ring_resonator'\npath = os.path.join(\"runs\", name)\n\n# length units are arbitrary so long as they are consistent, in this case [um]. everything gets normalized around origin wavelength and period at backend.\nwavelength = 1.55  # characteristic wavelength [um]\nbandwidth = 0.1  # wavelength bandwidth [um]\nwavelengths = np.linspace(wavelength - bandwidth / 2, wavelength + bandwidth / 2, 401)\n\nr = 3.1  # radius of ring\nw_wg = 0.4  # width of waveguide\ngap = 0.1  # gap between waveguide and ring\nth = 0.18  # th of waveguide\n\n# gds layers\nWG = (1, 0)  # waveguide layer\nBBOX = (10, 0)  # bounding box layer\n\n# we create geometry in gdsfactory. alternatively, you can import .gds layout into gdsfactory or .stl bodies directly into ours\n\n# margins\nheight_port_margin = lateral_port_margin = 0.8\nmargin = 1.25 * lateral_port_margin\nzmargin = 1.25 * height_port_margin\nsource_port_margin = 1.0 * (w_wg + 2 * lateral_port_margin)\n\n# draw layout in gdsfactory. `gf.components` defaults to layer WG = (1, 0)\nc = gf.Component()\n\ndut = c << gf.components.ring(radius=r, width=w_wg, layer=WG)\n\nl_branch = 2 * r + w_wg + source_port_margin + 2*margin\nxoffset = -source_port_margin - margin - r - w_wg / 2\nyoffset = w_wg + gap + r\nbranch_top = c << gf.components.straight(length=l_branch, width=w_wg)\nbranch_top.move((xoffset, w_wg + gap + r))\n\nbranch_bottom_left = c << gf.components.straight(length=source_port_margin, width=w_wg)\nbranch_bottom_left.move((xoffset, -yoffset))\n\nbranch_bottom_right = c << gf.components.straight(length=l_branch - source_port_margin, width=w_wg)\nbranch_bottom_right.connect(\"o1\", branch_bottom_left.ports[\"o2\"])\n\n\n# add ports\nc.add_port(\"o1\", port=branch_bottom_right.ports[\"o1\"])\nc.add_port(\"o2\", port=branch_bottom_right.ports[\"o2\"])  # thru channel\nc.add_port(\"o3\", port=branch_top.ports[\"o1\"])  # drop channel\n\nc << gf.components.bbox(component=c, layer=BBOX, top=margin, bottom=margin)\nc.plot()","key":"eHnv3L75Rp"},{"type":"outputs","id":"SbUEvY5MuHhSltPYkSwFt","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"504e7d5947c823d8e211e0f56709127a","path":"/504e7d5947c823d8e211e0f56709127a.png"},"text/plain":{"content":"<Figure size 800x600 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"BJRbWU7Rb5"}],"key":"WXNRGMjvb0"}],"key":"NvYDV3YNRU"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Solve","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sKAdFIQOnn"}],"identifier":"solve","label":"Solve","html_id":"solve","implicit":true,"key":"LxoZ6EGlAy"}],"key":"P6WVQXZs8u"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# for gdsfactory, we need vertical layer stack. \"core\" layer is special as `height_port_margin` are demarcated from it for defining modal sources and monitors. during 3d meshing lower mesh order layers supplant higher mesh order layers\nlayer_stack = LayerStack(\n    layers={\n        \"core\": LayerLevel(\n            layer=LogicalLayer(layer=WG),\n            thickness=th,\n            zmin=0.0,\n            material=\"Si\",\n            mesh_order=10,\n        ),\n    }\n)\n\n# our default lumi.MATERIAL_LIBRARY lib covers limited range of photonic and PCB material_library. here we create our own material_library. `background` is special and tags regions outside any bodies during meshing\nmaterial_library = {\n    \"Si\": lumi.Material(epsilon=12.25),\n    \"SiO2\": lumi.Material(epsilon=2.25),\n}\nmaterial_library[\"background\"] = material_library[\n    \"SiO2\"\n]  \n\n# source launches `source_port_margin` in front of port. it's bidirectional: the other direction goes into PML. pulse spectrum rolls off gradually past bandwidth limits.\nsources = [\n    lumi.Source(\n        \"o1\",\n        source_port_margin=source_port_margin,\n        wavelength=wavelength,\n        bandwidth=wavelength/5,\n        modenums=[0],  # fundamental mode only\n    )\n]\n\nlx=w_wg + 2 * lateral_port_margin\nly=th + 2 * height_port_margin\nmodes = [lumi.Mode(\n    ports=[f'o{i}' for i in [1, 2, 3]], # ports that this mode applies to\n    wavelengths=lumi.chebyshev_nodes(wavelengths[0], wavelengths[-1]),\n    start=[-lx/2, -height_port_margin], # local xy frame, local y=0 at global zmin of port layer\n    stop=[lx/2, th + height_port_margin],\n    )]\n\nlumi.make(\n    path=path,\n    component=c,\n    wavelengths=wavelengths,\n    sources=sources,\n    modes=modes,\n    # limits\n    zmin=-zmargin,\n    zmax=th + zmargin,\n    # materials and layers\n    material_library=material_library,\n    layer_stack=layer_stack,\n    # accuracy and speed settings\n    gpu=\"CUDA\",  # use GPU acceleration\n    nres=8,  # number of grid points per wavelength in material (not vacuum)\n    relative_courant=0.95,  # relative to maximum theoretical Courant number at\n    relative_pml_depths=[1, 1, 0.3],  \n    Tsim=600,  # max time [periods]\n    field_decay_threshold=0.001,  # field energy decay threshold for stopping simulation\n    saveat=50,  # save and plot field every n periods\n)\n\nlumi.solve(path)","key":"sqaF82z9xs"},{"type":"outputs","id":"ufu4YcOwNshX9jWcKRDKR","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"saving mode plots to runs\\photonic_ring_resonator\\modes\\1\nshowing modes for first wavelength \nusing simulation folder C:\\Users\\default.LAPTOP-HMRU58MH\\Desktop\\lumi\\luminescent\\runs\\photonic_ring_resonator\n0.02767857142857143\n0.02767857142857143\n0.02767857142857143\n0.02767857142857143\nloading problem from C:\\Users\\default.LAPTOP-HMRU58MH\\Desktop\\lumi\\luminescent\\runs\\photonic_ring_resonator\n========================================\n\ncan't find fdtd binary \n"},"children":[],"key":"sLwRLbxsdH"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"cacb835a2b022e57bf7d9aa7371bc678","path":"/cacb835a2b022e57bf7d9aa7371bc678.png"},"text/plain":{"content":"<Figure size 640x480 with 6 Axes>","content_type":"text/plain"}}},"children":[],"key":"VdM8nn2MlA"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"79fa5ca15eeae367440cd55e80e5fb2a","path":"/79fa5ca15eeae367440cd55e80e5fb2a.png"},"text/plain":{"content":"<Figure size 640x480 with 6 Axes>","content_type":"text/plain"}}},"children":[],"key":"Re0i25pb2N"}],"key":"wzw2r5OLa9"}],"key":"WL1Tm5ucMg"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualize","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"t6g4PDyQcb"}],"identifier":"visualize","label":"Visualize","html_id":"visualize","implicit":true,"key":"UmF7DBBXbV"}],"key":"Fytkb3U6CL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"views=[lumi.View(\"Hz\", z=\"halfway\", y=0, x=0)]\nlumi.peek(path,views) # halfway and final snapshots","key":"vcDVgCUMQw"},{"type":"outputs","id":"hdr1GXyrhaYXMwTuwpNa7","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"========================================\n\nfailed plotting new frames\n"},"children":[],"key":"wyJBzZAz0E"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"5e6471092766f0b13500251e8084ec0d","path":"/5e6471092766f0b13500251e8084ec0d.png"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"children":[],"key":"riS5Mhklu0"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"3c29ac096a3259bc9502cf3867939499","path":"/3c29ac096a3259bc9502cf3867939499.png"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"children":[],"key":"KTdx8qlMiW"}],"key":"Qx8pSHz6r0"}],"key":"e46YZSycNP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"lumi.movie(path,views) # full movie - this may take a while to generate\n# due to frame aliasing the movie may appear to show the signal going around once when in effect it goes around multiple times. To fix this, use lower `saveat`","key":"H0yhlvU3dd"},{"type":"outputs","id":"AkBSyjRaEOhjuqLPCGs4m","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"========================================\n\nfailed plotting new frames\nVideo generated successfully at C:\\Users\\default.LAPTOP-HMRU58MH\\Desktop\\lumi\\luminescent\\runs\\photonic_ring_resonator\\simulation.gif!\n"},"children":[],"key":"lw1egDYvNN"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/gif":{"content_type":"image/gif","hash":"f3524d9f51293e1af7557d49256df44c","path":"/f3524d9f51293e1af7557d49256df44c.gif"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"children":[],"key":"XOa9nWP9u3"}],"key":"WB0lb2IwuU"}],"key":"kJ7MBS80UO"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Analysis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JATtrn1zsg"}],"identifier":"analysis","label":"Analysis","html_id":"analysis","implicit":true,"key":"WIWZ3vgGuk"}],"key":"ziAifYxusO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"sol = lumi.load(path)\nx = wavelengths\n\ny = lumi.query(sol, \"To3@0,o1@0\")  # wavelength or frequency ordered depending on problem setup\n# y = lumi.query(sol, \"T3,1\") # wavelength or frequency ordered depending on problem setup\n# y=math.abs2(sol['waves']['o3@0']/sol['waves']['o1@0'])\n\nplt.plot(x, y)\nplt.xlabel(\"wavelength [um]\")\nplt.ylabel(\"drop channel transmitted power\")\nplt.show()","key":"Nfb3gfh8xi"},{"type":"outputs","id":"xLnWdfm4c9nNBy4L1r9jW","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"loading solution from C:\\Users\\default.LAPTOP-HMRU58MH\\Desktop\\lumi\\luminescent\\runs\\photonic_ring_resonator\n"},"children":[],"key":"gKxfI5BKrk"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7602f35f8af13112e49c984b084d6246","path":"/7602f35f8af13112e49c984b084d6246.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"TsjjCPvilQ"}],"key":"hSLYAeOuXo"}],"key":"EPb4apjHhm"}],"key":"Fvuz2xemw8"},"references":{"cite":{"order":[],"data":{}}}}