{"version":3,"kind":"Notebook","sha256":"358705ebaae6a63c50a3649cd03eb925e8b897f6ef51b74574547748c196eecc","slug":"test-stub","location":"/test_stub.ipynb","dependencies":[],"frontmatter":{"title":"RF microstrip: quarter wave stub filter","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"base","language":"python"},"numbering":{"title":{"offset":2}},"exports":[{"format":"ipynb","filename":"test_stub.ipynb","url":"/test_stub-9d3828d24e6a3bb6b23bd324ae80685e.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Overview","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"v2E1iWGUv7"}],"identifier":"overview","label":"Overview","html_id":"overview","implicit":true,"key":"afamq8eaf1"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We simulate a quarter wave stub bandstop filter in RF microstrip with nominal 5GHz notch.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"GajoaTQmF5"}],"key":"A2GsLlSPur"}],"key":"ubeNnAfMww"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# render movie","key":"cv1IN5vBjN"},{"type":"outputs","id":"lpiDi2-vRgt8PGDQMaBIh","children":[],"key":"ROoIyjWknB"}],"key":"LqH9ftuKxa"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Geometry","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gisETi0xrZ"}],"identifier":"geometry","label":"Geometry","html_id":"geometry","implicit":true,"key":"WZzD6Nxr0l"}],"key":"DkQZGi58gU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import luminescent as lumi\nfrom gdsfactory.technology import LogicalLayer, LayerLevel, LayerStack\nimport gdsfactory as gf\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport os\n\n# simulation folder\nname='microstrip_stub_filter'\npath = os.path.join(\"runs\", name)\n\n# length and frequency units are arbitrary but must be consistent. here we use mm and GHz\nfrequency = 5  # characteristic frequency in GHz\nfrequencies = np.linspace(3, 7, 81).tolist()\nwl1f = 300  # vacuum wavelength at 1 unit of frequency, all in your units\nwavelength = wl1f / frequency  # characteristic wavelength\nbandwidth = max(frequencies) - min(frequencies)\n\n# microstrip\nw_line = 1.52  # mm\nth = 0.035  # mm\nd = 0.8  # mm\nc = 87.5 / 139  # relative signal speed, from microstrip calculator\n\nwl_sig = wl1f * c / frequency  # wavelength in the signal line\nl_stub = wl_sig / 4 # quarter-wave stub length\nl_feed = 1 * l_stub\nlateral_port_margin = height_port_margin = 2 * d\nmargin = zmargin = 1.25 * lateral_port_margin\nlx_mode = w_line + 2 * lateral_port_margin  # lateral size of mode region\nsource_port_margin = 1.5 * (w_line + 2 * lateral_port_margin)\n\n# layers\nFEED = 1, 0\nSTUB = 2, 0\nSUB = 10, 0\n\n# make geometry in gdsfadory\n# alternatively can import .gds into gdsfadory\nc = gf.Component()\nfeed = c << lumi.straight(length=l_feed, width=w_line, layer=FEED)\nstub = c << lumi.straight(length=l_stub, width=w_line, layer=STUB)\nstub.rotate(90)\nstub.movex(l_feed / 2)\next = c << lumi.straight(source_port_margin, width=w_line, layer=FEED)\next.connect(\"o2\", feed.ports[\"o1\"])\n\nfor i in (1, 2):\n    c.add_port(f\"o{i}\", port=feed.ports[f\"o{i}\"])\n\nc << gf.components.bbox(component=c, layer=SUB, top=margin, bottom=margin)\nc.plot()","key":"dwmFt9Pqlq"},{"type":"outputs","id":"gBe8MljeHtKYUkhuDkjGe","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"running luminescent python frontend\n"},"children":[],"key":"Cf3D27H6GZ"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7a1d59df4cbf832d206846e0ae4436b5","path":"/7a1d59df4cbf832d206846e0ae4436b5.png"},"text/plain":{"content":"<Figure size 800x600 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"SWbK1xjlnb"}],"key":"fG47MNKxiC"}],"key":"U25wv8M6WZ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Solve","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ocb63EmNpk"}],"identifier":"solve","label":"Solve","html_id":"solve","implicit":true,"key":"pHiQh5LPIT"}],"key":"MI7phsD97C"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# adaptive meshing\nnres = 16\ndx0 = wavelength / nres\n\nlayer_stack = LayerStack(\n    layers={\n        \"feed\": LayerLevel(\n            layer=LogicalLayer(layer=FEED),\n            zmin=0,\n            thickness=th,\n            material=\"PEC\",\n            mesh_order=10,\n        ),\n        \"stub\": LayerLevel(\n            layer=LogicalLayer(layer=STUB),\n            zmin=0,\n            thickness=th,\n            material=\"PEC\",\n            mesh_order=20,\n        ),\n        \"core\": LayerLevel(\n            layer=LogicalLayer(layer=SUB),\n            zmin=-d,\n            thickness=d,\n            material=\"sub\",\n            mesh_order=30,\n        ),\n    }\n)\n\n# materials\neps_sub = 4.3\nn_sub = np.sqrt(eps_sub)\n\ndx = w_line / 4  # 4 mesh points across the strip\nn_PEC = dx0 / (dx)  # mesh density relative to vacuum\n\nmaterial_library = {\n    \"sub\": lumi.Material(epsilon=eps_sub),\n    \"PEC\": lumi.PECMaterial(mesh_density=n_PEC),\n}\nmaterial_library[\"background\"] = lumi.Material(epsilon=1.0)\n\n_dx=dx \n_dy=th\nmodes = [\n    lumi.Mode(\n        ports=[\"o1\", \"o2\"],\n        frequencies=[frequency],\n        metallic_boundaries=[\"y-\", \"feed\"],\n        nmodes=1,\n        start=[-lx_mode/2, -d], # local xy frame, local y=0 at global zmin of port layer\n        stop=[lx_mode/2, th + height_port_margin],\n        voltage_line=[(0, -d), (0, 0)], # optional\n        current_loop=[\n            (-w_line / 2 - _dx,  - _dy),\n            (-w_line / 2 - _dx,  th + _dy),\n            (w_line / 2 + _dx,  th + _dy),\n            (w_line / 2 + _dx,  - _dy),\n        ], # optional\n    )\n]\n\nsources = [\n    lumi.Source(\n        \"o1\", frequency=frequency, duration=0.5, source_port_margin=source_port_margin\n    ) # modulated Gaussian pulse\n]\n \nlumi.make(\n    path=path,\n    component=c,\n    frequency=frequency, # characteristic frequency\n    frequencies=frequencies,\n    wl1f=wl1f,\n    boundaries=[\"PML\", \"PML\", [\"PEC\", \"PML\"]],\n    sources=sources,\n    modes=modes,\n    #\n    material_library=material_library,\n    layer_stack=layer_stack,\n    zmin=-d,\n    zmax=th + zmargin,\n    # performance\n    gpu=\"CUDA\",  # use GPU acceleration)\n    nres=nres,\n    relative_courant=0.9,  # relative courant number between 0 and 1\n    relative_pml_depths=[1, 0.3, 0.3],\n    field_decay_threshold=0.01,  # field decay threshold for stopping simulation\n    saveat=0.25,  # save frame for plotting every _ periods\n)\nlumi.solve(path)","key":"NAlc6s4srN"},{"type":"outputs","id":"MGDf7COxMi-m6VAMemUsd","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"saving mode plots to runs\\microstrip_stub_filter\\modes\\1\nshowing modes for first wavelength \nsolving modes with PEC boundaries\nSolving port modes with FEM...\n"},"children":[],"key":"RsPS7mGQMx"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"5ad940aacb99e95f81daca1d9a4672e1","path":"/5ad940aacb99e95f81daca1d9a4672e1.png"},"text/plain":{"content":"<Figure size 640x480 with 6 Axes>","content_type":"text/plain"}}},"children":[],"key":"sPkFxF5oRL"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"a6862bbd0c424a76fa29825f2259239d","path":"/a6862bbd0c424a76fa29825f2259239d.png"},"text/plain":{"content":"<Figure size 640x480 with 6 Axes>","content_type":"text/plain"}}},"children":[],"key":"ymzLr8A2rO"},{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"c:\\Users\\default.LAPTOP-HMRU58MH\\anaconda3\\Lib\\site-packages\\skfem\\assembly\\form\\linear_form.py:44: ComplexWarning: Casting complex values to real discards the imaginary part\n  data[ixs] = self._kernel(vbasis.basis[i], w, dx)\nc:\\Users\\default.LAPTOP-HMRU58MH\\Desktop\\lumi\\luminescent\\luminescent\\utils.py:616: ComplexWarning: Casting complex values to real discards the imaginary part\n  E = np.array(\nc:\\Users\\default.LAPTOP-HMRU58MH\\Desktop\\lumi\\luminescent\\luminescent\\utils.py:629: ComplexWarning: Casting complex values to real discards the imaginary part\n  H = np.array(\n"},"children":[],"key":"oaFJmDJohl"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"using simulation folder c:\\Users\\default.LAPTOP-HMRU58MH\\Desktop\\lumi\\luminescent\\runs\\microstrip_stub_filter\n0.19\n0.19\n0.19\n0.9042052915695228\nloading problem from C:\\Users\\default.LAPTOP-HMRU58MH\\Desktop\\lumi\\luminescent\\runs\\microstrip_stub_filter\n========================================\n\ncan't find fdtd binary \n"},"children":[],"key":"ZfUGR5YbFA"}],"key":"tWmDtRcD75"}],"key":"JR6gIPREAT"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualize","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oeEbRZtXzm"}],"identifier":"visualize","label":"Visualize","html_id":"visualize","implicit":true,"key":"kfl76vNocq"}],"key":"nseNHyL6ly"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"material_color_map={\n        'background':'transparent',\n        'sub':('yellow',.5),\n        'PEC':('black',.5), # (color, alpha)\n}\nviews=[\n        lumi.View(\"Ez\", x=-source_port_margin, y=0, z=-d / 2, material_color_map=material_color_map,material_library=material_library),\n        lumi.View(\"Hz\", x=-source_port_margin, y=0, z=th / 2, material_color_map=material_color_map,material_library=material_library),\n    ]\nlumi.peek(path, views) # snapshots at halfway and final time step","key":"cYmd4pFxtk"},{"type":"outputs","id":"gTB6umaOiGRGIxQ3T3_eo","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"========================================\n\nfailed plotting new frames\n"},"children":[],"key":"qsMeVlVx0O"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"32baf4a5be3bf26c499f9ca642112649","path":"/32baf4a5be3bf26c499f9ca642112649.png"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"children":[],"key":"wd4HdflJMA"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d68b4849a99312a35cbed1c3d7ef1492","path":"/d68b4849a99312a35cbed1c3d7ef1492.png"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"children":[],"key":"NrFPEItQ2C"}],"key":"slRoYfNBpB"}],"key":"EhynUpTJKz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"lumi.movie(path, views) # full movie - may take a while to render","key":"W7KIiq489K"},{"type":"outputs","id":"UUlAQrKISVGYcto0bWTfa","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"========================================\n\nfailed plotting new frames\nVideo generated successfully at C:\\Users\\default.LAPTOP-HMRU58MH\\Desktop\\lumi\\luminescent\\runs\\microstrip_stub_filter\\simulation.gif!\n"},"children":[],"key":"zXq75k2pRo"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/gif":{"content_type":"image/gif","hash":"1e9f59223a5f894b7a5b491522fa4b4a","path":"/1e9f59223a5f894b7a5b491522fa4b4a.gif"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"children":[],"key":"NkhLKbFOtr"}],"key":"wt49458iBL"}],"key":"a0eXcO1ScC"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Analysis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gGpZ57MaTy"}],"identifier":"analysis","label":"Analysis","html_id":"analysis","implicit":true,"key":"K4oFn5hs2x"}],"key":"f3ivi4l8Mb"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"sol = lumi.load(path)\nx = frequencies\ny = lumi.query(sol, \"To2,o1\") # convenience function for T-parameters using modal decomposition\n\n# S-parameters can also be computed explicitly from complex valued modal or voltage waves:\n# y = np.abs2(sol[\"waves\"][\"o2@0+\"] / sol[\"waves\"][\"o1@0-\"]) # explicit T21 using forward/backward modal amplitudes\n# y = np.abs2(sol[\"waves\"][\"o2+\"] / sol[\"waves\"][\"o1-\"]) # using forward/backward voltage waves\n\ny = [10 * np.log10(v) for v in y]\nplt.plot(x, y)\nplt.xlabel(\"f [GHz]\")\nplt.ylabel(\"S21 [dB]\")\nplt.show()","key":"WmblNrUeK7"},{"type":"outputs","id":"Q4RVtJ00s36TzJJ03WikO","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"loading solution from C:\\Users\\default.LAPTOP-HMRU58MH\\Desktop\\lumi\\luminescent\\runs\\microstrip_stub_filter\n"},"children":[],"key":"Cf7Ty5IJ38"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7d73bb86f6bf0cf337a08838801778e9","path":"/7d73bb86f6bf0cf337a08838801778e9.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"RyMQgxwQH8"}],"key":"whu5rfjEDz"}],"key":"syRqOckOSy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"y=377*sol['Z']['o1']\nplt.plot(x,np.real(y),label=\"Real\",color='orange')\nplt.plot(x,np.imag(y),label=\"Imaginary\",color='blue')\nplt.xlabel(\"f [GHz]\")\nplt.ylabel('complex line impedance [Ohms]')\nplt.legend()\nplt.show()","key":"t1AfKbAist"},{"type":"outputs","id":"RYglCmhrgJ433CWs5kiJJ","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"6befdc2146863a608339e9e6fad446b4","path":"/6befdc2146863a608339e9e6fad446b4.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"wYEWWcyPnm"}],"key":"T1uFtHtYh8"}],"key":"gdbiZoF22O"}],"key":"JXIVNuQNvZ"},"references":{"cite":{"order":[],"data":{}}}}