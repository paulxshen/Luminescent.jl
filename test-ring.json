{"version":3,"kind":"Notebook","sha256":"fbb15886c04532e1b4754ffa8b2b4902add4ed9cfdc4d4d204d73728612b35ed","slug":"test-ring","location":"/test_ring.ipynb","dependencies":[],"frontmatter":{"title":"Photonic integrated circuit: ring resonator","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"numbering":{"title":{"offset":2}},"exports":[{"format":"ipynb","filename":"test_ring.ipynb","url":"/Luminescent.jl/build/test_ring-882a04a3ad20a9cb1311c67d94424542.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Overview","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OKoqYwWKz1"}],"identifier":"overview","label":"Overview","html_id":"overview","implicit":true,"key":"su92SEGlBv"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We simulate small silicon ring resonator coupled to parallel waveguides buried in silica cladding. We use midplane z PMC symmetry to slash cell count by half.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"rJR9TI3ViB"}],"key":"W3yf8RKzje"}],"key":"mCWIxMyJAk"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Geometry","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CjoJMt5sPU"}],"identifier":"geometry","label":"Geometry","html_id":"geometry","implicit":true,"key":"IJSuSLUPzI"}],"key":"c969c7HdUp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import luminescent as lumi\nfrom gdsfactory.technology import LogicalLayer, LayerLevel, LayerStack\nimport gdsfactory as gf\nimport numpy as np\nimport os\nimport matplotlib.pyplot as plt\n\n# simulation folder \nstudy='photonic_ring_resonator'\npath = os.path.join('studies', study)\n\n# length units are arbitrary so long as they are consistent, in this case [um]. everything gets normalized around origin wavelength and period at backend.\nwavelength = 1.55  # characteristic wavelength [um]\nbandwidth = 0.1  # wavelength bandwidth [um]\nwavelengths = np.linspace(wavelength - bandwidth / 2, wavelength + bandwidth / 2, 401)\n\nr = 3.1  # radius of ring\nw_wg = 0.4  # width of waveguide\ngap = 0.1  # gap between waveguide and ring\nh_wg = 0.18  # h_wg of waveguide\n\n# gds layers\nWG = (1, 0)  # waveguide layer\nBBOX = (10, 0)  # bounding box layer\n\n# we create geometry in gdsfactory. alternatively, you can import .gds layout into gdsfactory or .stl bodies directly into ours\n\n# margins\nheight_port_margin = lateral_port_margin = 0.8\nmargin = 1.2 * lateral_port_margin\nzmargin = 1.2 * height_port_margin\nsource_port_margin = 1.0 * (w_wg + 2 * lateral_port_margin)\n\n# draw layout in gdsfactory. `gf.components` defaults to layer WG = (1, 0)\nc = gf.Component()\n\ndut = c << gf.components.ring(radius=r, width=w_wg, layer=WG)\n\nl_branch = 2 * r + w_wg + source_port_margin + 2*margin\nxoffset = -source_port_margin - margin - r - w_wg / 2\nyoffset = w_wg + gap + r\nbranch_top = c << gf.components.straight(length=l_branch, width=w_wg)\nbranch_top.move((xoffset, w_wg + gap + r))\n\nbranch_bottom_left = c << gf.components.straight(length=source_port_margin, width=w_wg)\nbranch_bottom_left.move((xoffset, -yoffset))\n\nbranch_bottom_right = c << gf.components.straight(length=l_branch - source_port_margin, width=w_wg)\nbranch_bottom_right.connect(\"o1\", branch_bottom_left.ports[\"o2\"])\n\n\n# add ports\nc.add_port(\"o1\", port=branch_bottom_right.ports[\"o1\"])\nc.add_port(\"o2\", port=branch_bottom_right.ports[\"o2\"])  # thru channel\nc.add_port(\"o3\", port=branch_top.ports[\"o1\"])  # drop channel\n\nc << gf.components.bbox(component=c, layer=BBOX, top=margin, bottom=margin)\nc.plot()","key":"mGH6iSGHfX"},{"type":"outputs","id":"WVPsYmLBbTtB0HGnOf9vU","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"da3a3e64b387eda9158433ef8b99f537","path":"/Luminescent.jl/build/da3a3e64b387eda9158433ef8b99f537.png"},"text/plain":{"content":"<Figure size 800x600 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"PnVZoLTP6L"}],"key":"Q6zjcCaCOh"}],"key":"aMRq5qIDih"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Solve","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WilTQntzZI"}],"identifier":"solve","label":"Solve","html_id":"solve","implicit":true,"key":"aL5imqd0MF"}],"key":"cbbmv588ND"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# for gdsfactory, we need vertical layer stack. \"core\" layer is special as `height_port_margin` are demarcated from it for defining modal sources and monitors. during 3d meshing lower mesh order layers supplant higher mesh order layers\nlayer_stack = LayerStack(\n    layers={\n        \"core\": LayerLevel(\n            layer=LogicalLayer(layer=WG),\n            thickness=h_wg/2,\n            zmin=0.0,\n            material=\"Si\",\n            mesh_order=10,\n        ),\n    }\n)\n\n# our default lumi.MATERIAL_LIBRARY lib covers limited range of photonic and PCB material_library. here we create our own material_library. `background` is special and tags regions outside any bodies during meshing\nmaterial_library = {\n    \"Si\": lumi.Material(epsilon=12.25),\n    \"SiO2\": lumi.Material(epsilon=2.25),\n}\nmaterial_library[\"background\"] = material_library[\n    \"SiO2\"\n]  \n\n# source launches `source_port_margin` in front of port. it's bidirectional: the other direction goes into PML. pulse spectrum rolls off gradually past bandwidth limits.\nsources = [\n    lumi.Source(\n        \"o1\",\n        source_port_margin=source_port_margin,\n        wavelength=wavelength,\n        bandwidth=wavelength/5,\n        modenums=[0],  # fundamental mode only\n    )\n]\n\nlx = w_wg + 2 * lateral_port_margin\nly = h_wg + 2 * height_port_margin\nmodes = [\n    lumi.Mode(\n        wavelengths=np.linspace(wavelengths[0], wavelengths[-1],5),\n        start=[-lx / 2, 0],  # local xy frame\n        stop=[lx / 2, h_wg/2 + height_port_margin],\n        boundaries=['PML',('PMC','PML')]\n    )\n]\n\n# Luminescent community cluster client\nemail=____ # replace with your registered email\nclient=lumi.Client(email,cluster='luminescent_community_cluster')\n\nlumi.make(\n    path=path,\n    component=c,\n    wavelengths=wavelengths,\n    sources=sources,\n    modes=modes,\n    # limits\n    boundaries=['PML','PML',('PMC','PML')], # z midplane PMC symmetry\n    zmin=0,\n    zmax=h_wg/2 + zmargin,\n    # materials and layers\n    material_library=material_library,\n    layer_stack=layer_stack,\n    # accuracy and speed settings\n    nres=8,  # number of grid points per wavelength in material (not vacuum)\n    relative_courant=0.95,  # relative to maximum theoretical Courant number at\n    relative_pml_depths=[1, 1, 0.25],  \n    tmax=1000,  # max time [periods]\n    energy_decay_threshold=0.001,  # field energy decay threshold for stopping simulation\n    saveat=50,  # save and plot field every _ periods, involves slow disk write\n    # visualization\n    views=[lumi.View(\"Hz\",x=0,y=0,z=0)],\n    # \n    client=client,\n)","key":"JqOuX5lZhM"},{"type":"outputs","id":"rFh3YxgX1mZ8z28cF18lG","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"saving mode plots to /home/weihu/lumi/luminescent/studies/photonic_ring_resonator/modes/1\nshowing modes for first wavelength \nmode Boundary conditions: 0A00\n/home/weihu/lumi/luminescent/studies/photonic_ring_resonator/modes/1/1.5 mode 0 (neff=2.264+0.000j)\n/home/weihu/lumi/luminescent/studies/photonic_ring_resonator/modes/1/1.5 mode 1 (neff=1.433+0.000j)\nmode Boundary conditions: 0A00\nmode Boundary conditions: 0A00\nmode Boundary conditions: 0A00\nmode Boundary conditions: 0A00\nusing simulation folder /home/weihu/lumi/luminescent/studies/photonic_ring_resonator\n0.02767857142857143\nLoading mesh from: /home/weihu/lumi/luminescent/studies/photonic_ring_resonator/geometry/1____Si____core____unnamed11.obj\n0.02767857142857143\nLoading mesh from: /home/weihu/lumi/luminescent/studies/photonic_ring_resonator/geometry/2____Si____core____unnamed21.obj\n0.02767857142857143\nLoading mesh from: /home/weihu/lumi/luminescent/studies/photonic_ring_resonator/geometry/4____Si____core____unnamed41.obj\n0.02767857142857143\nLoading mesh from: /home/weihu/lumi/luminescent/studies/photonic_ring_resonator/geometry/3____Si____core____unnamed31.obj\n"},"children":[],"key":"DZQULbxkgr"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"bbe9f993eb29c2cf0cf79695d2bf14d9","path":"/Luminescent.jl/build/bbe9f993eb29c2cf0cf79695d2bf14d9.png"},"text/plain":{"content":"<Figure size 640x480 with 6 Axes>","content_type":"text/plain"}}},"children":[],"key":"J16HVjBFsV"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4dcd0c7cb03f9b2a9c41455a920ef417","path":"/Luminescent.jl/build/4dcd0c7cb03f9b2a9c41455a920ef417.png"},"text/plain":{"content":"<Figure size 640x480 with 6 Axes>","content_type":"text/plain"}}},"children":[],"key":"hqrhYaT0Gv"}],"key":"jAK1hY0Kys"}],"key":"j8qaKe9BB0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"lumi.solve(path)","key":"RwK7X9VHiz"},{"type":"outputs","id":"X_HxFUmV5ecEgZLf7w-cd","children":[],"key":"USjJFkgKZm"}],"key":"jjTGQIOJxs"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualize","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pQqzXtoddS"}],"identifier":"visualize","label":"Visualize","html_id":"visualize","implicit":true,"key":"Vhe3NfKGjF"}],"key":"B1SvuZoOFI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"lumi.movie(path) # full movie - this may take a while to generate","key":"zWh1EljZES"},{"type":"outputs","id":"YV4UQr0qCSlzbAs_BT83V","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Video generated successfully at /home/weihu/luminescent_community_cluster/paul@luminescentai.com/photonic_ring_resonator/simulation.gif!\n"},"children":[],"key":"bQymwz2GfY"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/gif":{"content_type":"image/gif","hash":"05acbc1ca720e89e595527cec29a72be","path":"/Luminescent.jl/build/05acbc1ca720e89e595527cec29a72be.gif"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"children":[],"key":"f9yJAgGdsW"}],"key":"o5aeDteY26"}],"key":"RrfflQ2Lx1"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Analysis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OWmkqQNpIs"}],"identifier":"analysis","label":"Analysis","html_id":"analysis","implicit":true,"key":"DobnsTfyOH"}],"key":"dhU4iZPfBP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"sol = lumi.load(path)\nx = wavelengths\n\n# S or T params. wavelength or frequency ordered depending on problem setup\ny = lumi.query(sol, \"To3@0,o1@0\")  # same as y=np.abs2(sol['waves']['o3@0+']/sol['waves']['o1@0-'])\n# y = lumi.query(sol, \"T3,1\") # flux\n\nplt.plot(x, y)\nplt.xlabel(\"wavelength [um]\")\nplt.ylabel(\"drop channel transmitted power\")\nplt.show()","key":"ZTUkdPbia8"},{"type":"outputs","id":"NuRLni-787GDIFavK0208","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"loading solution from /home/weihu/lumi/luminescent/studies/photonic_ring_resonator\nmay take a minute if simulation folder is remotely mounted\n"},"children":[],"key":"ca4Wehp4YZ"},{"type":"output","jupyter_data":{"ename":"FileNotFoundError","evalue":"[Errno 2] No such file or directory: '/home/weihu/lumi/luminescent/studies/photonic_ring_resonator/.solution.json.tar'","output_type":"error","traceback":"\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mFileNotFoundError\u001b[39m                         Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[4]\u001b[39m\u001b[32m, line 1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m sol = \u001b[43mlumi\u001b[49m\u001b[43m.\u001b[49m\u001b[43mload\u001b[49m\u001b[43m(\u001b[49m\u001b[43mpath\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m      2\u001b[39m x = wavelengths\n\u001b[32m      4\u001b[39m \u001b[38;5;66;03m# S or T params. wavelength or frequency ordered depending on problem setup\u001b[39;00m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/lumi/luminescent/luminescent/sol.py:130\u001b[39m, in \u001b[36mload\u001b[39m\u001b[34m(path, show)\u001b[39m\n\u001b[32m    128\u001b[39m \u001b[38;5;28mprint\u001b[39m(\u001b[33mf\u001b[39m\u001b[33m\"\u001b[39m\u001b[33mloading solution from \u001b[39m\u001b[38;5;132;01m{\u001b[39;00mpath\u001b[38;5;132;01m}\u001b[39;00m\u001b[33m\"\u001b[39m)\n\u001b[32m    129\u001b[39m \u001b[38;5;28mprint\u001b[39m(\u001b[33mf\u001b[39m\u001b[33m\"\u001b[39m\u001b[33mmay take a minute if simulation folder is remotely mounted\u001b[39m\u001b[33m\"\u001b[39m)\n\u001b[32m--> \u001b[39m\u001b[32m130\u001b[39m \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[43mreadjsonnp\u001b[49m\u001b[43m(\u001b[49m\u001b[43mos\u001b[49m\u001b[43m.\u001b[49m\u001b[43mpath\u001b[49m\u001b[43m.\u001b[49m\u001b[43mjoin\u001b[49m\u001b[43m(\u001b[49m\u001b[43mpath\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[33;43m\"\u001b[39;49m\u001b[33;43msolution.json\u001b[39;49m\u001b[33;43m\"\u001b[39;49m\u001b[43m)\u001b[49m\u001b[43m)\u001b[49m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/lumi/luminescent/luminescent/utils.py:113\u001b[39m, in \u001b[36mreadjsonnp\u001b[39m\u001b[34m(path)\u001b[39m\n\u001b[32m    111\u001b[39m _TAR = os.path.join(os.path.dirname(path), \u001b[33mf\u001b[39m\u001b[33m\"\u001b[39m\u001b[33m.\u001b[39m\u001b[38;5;132;01m{\u001b[39;00mos.path.basename(path)\u001b[38;5;132;01m}\u001b[39;00m\u001b[33m.tar\u001b[39m\u001b[33m\"\u001b[39m)\n\u001b[32m    112\u001b[39m TAR = \u001b[33mf\u001b[39m\u001b[33m\"\u001b[39m\u001b[33m.\u001b[39m\u001b[38;5;132;01m{\u001b[39;00mos.path.basename(path)\u001b[38;5;132;01m}\u001b[39;00m\u001b[33m.tar\u001b[39m\u001b[33m\"\u001b[39m\n\u001b[32m--> \u001b[39m\u001b[32m113\u001b[39m \u001b[43mshutil\u001b[49m\u001b[43m.\u001b[49m\u001b[43mcopy2\u001b[49m\u001b[43m(\u001b[49m\u001b[43m_TAR\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mTAR\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    115\u001b[39m DATA = \u001b[33mf\u001b[39m\u001b[33m\"\u001b[39m\u001b[33m.\u001b[39m\u001b[38;5;132;01m{\u001b[39;00mos.path.basename(path)\u001b[38;5;132;01m}\u001b[39;00m\u001b[33m\"\u001b[39m\n\u001b[32m    116\u001b[39m shutil.rmtree(DATA, ignore_errors=\u001b[38;5;28;01mTrue\u001b[39;00m)\n\n\u001b[36mFile \u001b[39m\u001b[32m/usr/lib/python3.12/shutil.py:475\u001b[39m, in \u001b[36mcopy2\u001b[39m\u001b[34m(src, dst, follow_symlinks)\u001b[39m\n\u001b[32m    472\u001b[39m         \u001b[38;5;28;01melse\u001b[39;00m:\n\u001b[32m    473\u001b[39m             \u001b[38;5;28;01mraise\u001b[39;00m\n\u001b[32m--> \u001b[39m\u001b[32m475\u001b[39m \u001b[43mcopyfile\u001b[49m\u001b[43m(\u001b[49m\u001b[43msrc\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mdst\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mfollow_symlinks\u001b[49m\u001b[43m=\u001b[49m\u001b[43mfollow_symlinks\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    476\u001b[39m copystat(src, dst, follow_symlinks=follow_symlinks)\n\u001b[32m    477\u001b[39m \u001b[38;5;28;01mreturn\u001b[39;00m dst\n\n\u001b[36mFile \u001b[39m\u001b[32m/usr/lib/python3.12/shutil.py:260\u001b[39m, in \u001b[36mcopyfile\u001b[39m\u001b[34m(src, dst, follow_symlinks)\u001b[39m\n\u001b[32m    258\u001b[39m     os.symlink(os.readlink(src), dst)\n\u001b[32m    259\u001b[39m \u001b[38;5;28;01melse\u001b[39;00m:\n\u001b[32m--> \u001b[39m\u001b[32m260\u001b[39m     \u001b[38;5;28;01mwith\u001b[39;00m \u001b[38;5;28;43mopen\u001b[39;49m\u001b[43m(\u001b[49m\u001b[43msrc\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[33;43m'\u001b[39;49m\u001b[33;43mrb\u001b[39;49m\u001b[33;43m'\u001b[39;49m\u001b[43m)\u001b[49m \u001b[38;5;28;01mas\u001b[39;00m fsrc:\n\u001b[32m    261\u001b[39m         \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[32m    262\u001b[39m             \u001b[38;5;28;01mwith\u001b[39;00m \u001b[38;5;28mopen\u001b[39m(dst, \u001b[33m'\u001b[39m\u001b[33mwb\u001b[39m\u001b[33m'\u001b[39m) \u001b[38;5;28;01mas\u001b[39;00m fdst:\n\u001b[32m    263\u001b[39m                 \u001b[38;5;66;03m# macOS\u001b[39;00m\n\n\u001b[31mFileNotFoundError\u001b[39m: [Errno 2] No such file or directory: '/home/weihu/lumi/luminescent/studies/photonic_ring_resonator/.solution.json.tar'"},"children":[],"key":"khFZibwTW5"}],"key":"JMlABHnwGw"}],"key":"HLlkAqOtXZ"}],"key":"m1YciNqx9q"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Installation","url":"/install","group":"Lumi FDTD"},"next":{"title":"Metasurface: microwave frequency selective surface (FSS)","url":"/test-fss","group":"Simulation tutorials"}}},"domain":"http://localhost:3007"}